function openNav() {
  document.getElementById('main-joltify-popup').classList.add('open');
  document.getElementById('joltify-popup-background').classList.add('open');

  document.body.style.overflow = 'hidden';
}

function closeNav() {
  document.getElementById('main-joltify-popup').classList.remove('open');
  document.getElementById('joltify-popup-background').classList.remove('open');
  document.body.style.overflow = 'visible';
}

function closePopup() {
  closeNav();
  document.getElementById('joltify-popup-tab').style.display = 'none';
}

function checkPreviewMode() {
  const urlParams = new URLSearchParams(window.location.search);
  const isPreview = urlParams.get('joltify_preview') === 'true';
  return isPreview;
}

document.addEventListener("DOMContentLoaded", () => {
  const live = <%= @wheel.live? %>;
  const preview = checkPreviewMode();
  if (!live && !preview) return;

  const popup = document.createElement('div');
  popup.innerHTML = `<%= render 'popup' %>`;
  popup.innerHTML = popup.innerHTML.replace('joltify_preview=false', `joltify_preview=${preview}`);
  document.body.insertBefore(popup, document.body.firstChild);
});

// Setup iframe event listeners

if (window.addEventListener) {
    window.addEventListener("message", onJoltifyMessage, false);
} 
else if (window.attachEvent) {
    window.attachEvent("onmessage", onJoltifyMessage, false);
}

function onJoltifyMessage(event) {
  if (event.data.message === 'CLOSE_POPUP') {
    closePopup();
  }
}
